{"version":3,"file":"static/webpack/static/development/pages/leaderboard.js.b344e2e4a9c7c4c31015.hot-update.js","sources":["webpack:///./pages/leaderboard.js","webpack:///./src/components/CopyLinkPopup.js"],"sourcesContent":["import React, { Component, useState } from 'react';\nimport _ from 'lodash';\nimport copy from 'copy-to-clipboard';\n\nimport { Container, Segment, Grid, Icon, Menu } from 'semantic-ui-react';\nimport SearchBar from '../src/components/SearchBar';\nimport { getStatsByUsername, getStatsByUid } from '../src/actions';\n\nimport Board from '../src/components/Board';\nimport CopyLinkPopup from '../src/components/CopyLinkPopup';\n\n// const CopyLinkPopup = ({ children }) => {\n//     const [isCopied, setCopied] = useState(false);\n//     const [link, setLink] = useState('');\n\n//     const handleCopyClipboard = link => {\n//         const didCopy = copy(link);\n//         setCopied(didCopy);\n//     };\n\n//     return (\n//         <Popup\n//             style={{ width: '100%' }}\n//             hideOnScroll\n//             hoverable\n//             on=\"click\"\n//             position=\"top center\"\n//             onOpen={() => setLink(location.href)}\n//             onClose={() => setCopied(false)}\n//             content={\n//                 <Grid textAlign=\"center\">\n//                     <Grid.Row textAlign=\"left\">\n//                         <Grid.Column textAlign=\"left\">\n//                             <Header as=\"h5\" color={isCopied ? 'green' : 'grey'}>\n//                                 {isCopied ? 'Link copied!' : 'Link to custom leaderboard: '}\n//                             </Header>\n//                         </Grid.Column>\n//                     </Grid.Row>\n//                     <Grid.Row style={{ paddingTop: '0px' }}>\n//                         <Grid.Column>\n//                             <Input value={link} />\n//                             <Button\n//                                 icon={isCopied ? 'check' : 'linkify'}\n//                                 color={isCopied ? 'green' : 'grey'}\n//                                 compact\n//                                 onClick={() => handleCopyClipboard(link)}\n//                             />\n//                         </Grid.Column>\n//                     </Grid.Row>\n//                 </Grid>\n//             }\n//             trigger={children}\n//         />\n//     );\n// };\n\nclass Leaderboard extends Component {\n    static async getInitialProps({ query }) {\n        let { usernames } = query;\n        const { mode } = query;\n        if (!usernames) return { usernames: [] };\n        // Format into Array\n        usernames = typeof usernames == 'string' ? [usernames] : usernames;\n        return { usernames, mode };\n    }\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            players: [],\n            mode: props.mode || 'solo',\n            columns: [],\n            activeColumn: null,\n            direction: null,\n            loading: null\n        };\n    }\n\n    componentDidMount() {\n        this.setState({ url: location.href });\n        this.initColumns();\n\n        const { usernames } = this.props;\n        if (usernames.length) {\n            this.initPlayers(usernames);\n        }\n    }\n\n    initColumns = () => {\n        this.setState({\n            columns: [\n                {\n                    header: 'Player',\n                    accessor: 'username',\n                    sort: this.handleSort('username')\n                },\n                {\n                    header: 'K/D',\n                    accessor: 'kd',\n                    sort: this.handleSort('kd')\n                },\n                {\n                    header: 'Win %',\n                    accessor: 'winrate',\n                    sort: this.handleSort('winrate')\n                },\n                {\n                    header: 'Kills',\n                    accessor: 'kills',\n\n                    sort: this.handleSort('kills')\n                },\n                {\n                    header: 'Wins',\n                    accessor: 'placetop1',\n                    sort: this.handleSort('placetop1')\n                }\n            ]\n        });\n    };\n\n    initPlayers = async usernames => {\n        let initialPlayers = [];\n        // Start load player stats\n        this.setState({\n            loading: true,\n            players: new Array(usernames.length).fill(null)\n        });\n\n        initialPlayers = await Promise.all(usernames.map(username => getStatsByUsername(username)));\n\n        // End load player stats\n        this.setState(\n            {\n                players: [...initialPlayers],\n                loading: false\n            },\n            () => this.updateURL()\n        );\n    };\n\n    refreshBoard = () => {\n        const { players } = this.state;\n        const usernames = players.map(player => player.username);\n        this.initPlayers(usernames);\n    };\n\n    addPlayer = async player => {\n        const { players, activeColumn, mode, direction } = this.state;\n        // Check if already added to board\n        if (this.isPlayerSelected(player.uid)) return;\n        // Not duplicate, get profile and add\n        const newPlayer = await getStatsByUid(player.uid);\n        let updatedPlayers = [...players, newPlayer];\n\n        // if pre-sorted then apply sort setting to updated players\n        if (activeColumn !== null) {\n            updatedPlayers = this.sortPlayers(updatedPlayers, activeColumn, mode, direction);\n        }\n\n        this.setState({ players: updatedPlayers }, () => this.updateURL());\n    };\n\n    removePlayer = index => {\n        const { players } = this.state;\n        const updatedPlayers = players.filter((player, i) => i !== index);\n        this.setState({ players: updatedPlayers }, () => this.updateURL());\n    };\n\n    changeMode = direction => {\n        const { mode } = this.state;\n        let nextMode = '';\n        switch (mode) {\n            case 'solo':\n                nextMode = direction === 'forward' ? 'duo' : 'squad';\n                break;\n            case 'duo':\n                nextMode = direction === 'forward' ? 'squad' : 'solo';\n                break;\n            case 'squad':\n                nextMode = direction === 'forward' ? 'solo' : 'duo';\n                break;\n            default:\n                break;\n        }\n        this.setState({ mode: nextMode }, () => this.updateURL());\n    };\n\n    handleSort = accessor => () => {\n        const { activeColumn, players, direction, mode } = this.state;\n        // Reverse order if direction set, else default to desc\n        let sortDirection = direction === 'desc' ? 'asc' : 'desc';\n        let sortedColumn = activeColumn;\n\n        // Default to desc order on column switch\n        if (activeColumn !== accessor) {\n            // Default to asc order if username column\n            sortDirection = accessor == 'username' ? 'asc' : 'desc';\n            // Set sorted column name\n            sortedColumn = accessor;\n        }\n        // Sort players\n        const sortedPlayers = this.sortPlayers(players, accessor, mode, sortDirection);\n        this.setState(\n            {\n                activeColumn: sortedColumn,\n                players: sortedPlayers,\n                direction: sortDirection\n            },\n            () => this.updateURL()\n        );\n    };\n\n    sortPlayers = (players, accessor, mode, direction) => {\n        return accessor == 'username'\n            ? _.orderBy(this.state.players, [o => o.username.toLowerCase()], [direction])\n            : _.orderBy(players, o => o.stats[`${accessor}_${mode}`], [direction]);\n    };\n\n    isPlayerSelected = uid => {\n        const { players } = this.state;\n        return players.find(player => player.uid === uid);\n    };\n\n    updateURL = () => {\n        const { router } = this.props;\n        const { players, mode } = this.state;\n        const usernames = players.map(player => player.username);\n        router.replace({\n            pathname: '/leaderboard',\n            query: { mode: mode, usernames: usernames },\n            options: { shallow: true }\n        });\n    };\n\n    render() {\n        const { activeColumn, columns, mode, players, loading } = this.state;\n\n        return (\n            <Container\n                textAlign=\"center\"\n                style={{\n                    paddingTop: '100px',\n                    paddingBottom: '100px'\n                    // height: '100%'\n                }}\n            >\n                <Grid centered textAlign=\"center\">\n                    <Grid.Row\n                        textAlign=\"center\"\n                        columns=\"1\"\n                        as={Segment}\n                        style={{\n                            color: 'white',\n                            backgroundColor: 'rgba(61, 74, 133, 0.3)'\n                            // backgroundColor: 'rgba(46, 49, 49, .6)'\n                        }}\n                    >\n                        <Grid.Column textAlign=\"center\">\n                            <h1>Leaderboards</h1>\n                        </Grid.Column>\n\n                        <Grid.Column\n                            mobile=\"16\"\n                            computer=\"6\"\n                            largeScreen=\"6\"\n                            tablet=\"6\"\n                            widescreen=\"6\"\n                            style={{ paddingBottom: '1em', paddingTop: '1em' }}\n                        >\n                            <SearchBar handleResultSelect={this.addPlayer} />\n                        </Grid.Column>\n                    </Grid.Row>\n\n                    <Grid.Row className=\"compact\">\n                        <Menu\n                            tabular\n                            fluid\n                            style={{ border: 'none', backgroundColor: 'rgba(61, 74, 133, 0)' }}\n                        >\n                            <Menu.Item\n                                fitted=\"vertically\"\n                                position=\"right\"\n                                as=\"a\"\n                                style={{\n                                    backgroundColor: 'rgba(61, 74, 133, 0.3)',\n                                    borderRadius: '0.28571429rem',\n                                    color: 'white'\n                                }}\n                            >\n                                <CopyLinkPopup>\n                                    <span>\n                                        Share <Icon name=\"share\" />\n                                    </span>\n                                </CopyLinkPopup>\n                            </Menu.Item>\n                            <Menu.Item\n                                fitted=\"vertically\"\n                                style={{\n                                    marginLeft: '5px',\n                                    borderRadius: '0.28571429rem',\n                                    backgroundColor: 'rgba(61, 74, 133, 0.3)',\n                                    color: 'white'\n                                }}\n                                as=\"a\"\n                                disabled={loading}\n                                onClick={() => this.refreshBoard()}\n                            >\n                                <span>\n                                    Refresh <Icon name=\"sync alternate\" />\n                                </span>\n                            </Menu.Item>\n                        </Menu>\n                    </Grid.Row>\n\n                    <Grid.Row>\n                        <Grid.Column textAlign=\"center\">\n                            <Board\n                                activeColumn={activeColumn}\n                                columns={columns}\n                                mode={mode}\n                                players={players}\n                                removePlayer={this.removePlayer}\n                                handleModeChange={this.changeMode}\n                                loading={loading}\n                            />\n                        </Grid.Column>\n                    </Grid.Row>\n                </Grid>\n            </Container>\n        );\n    }\n}\n\nexport default Leaderboard;\n","import React, { useState } from 'react';\nimport copy from 'copy-to-clipboard';\nimport { Grid, Popup, Button, Input, Header } from 'semantic-ui-react';\n\nconst CopyLinkPopup = ({ children }) => {\n    const [isCopied, setCopied] = useState(false);\n    const [link, setLink] = useState('');\n\n    const handleCopyClipboard = link => {\n        const didCopy = copy(link);\n        setCopied(didCopy);\n    };\n\n    return (\n        <Popup\n            style={{ width: '100%' }}\n            hideOnScroll\n            hoverable\n            on=\"click\"\n            position=\"top center\"\n            onOpen={() => setLink(location.href)}\n            onClose={() => setCopied(false)}\n            content={\n                <Grid textAlign=\"center\">\n                    <Grid.Row textAlign=\"left\">\n                        <Grid.Column textAlign=\"left\">\n                            <Header as=\"h5\" color={isCopied ? 'green' : 'grey'}>\n                                {isCopied ? 'Link copied!' : 'Link to custom leaderboard: '}\n                            </Header>\n                        </Grid.Column>\n                    </Grid.Row>\n                    <Grid.Row style={{ paddingTop: '0px' }}>\n                        <Grid.Column>\n                            <Input value={link} />\n                            <Button\n                                icon={isCopied ? 'check' : 'linkify'}\n                                color={isCopied ? 'green' : 'grey'}\n                                compact\n                                onClick={() => handleCopyClipboard(link)}\n                            />\n                        </Grid.Column>\n                    </Grid.Row>\n                </Grid>\n            }\n            trigger={children}\n        />\n    );\n};\n\nexport default CopyLinkPopup;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AAAA;;;;;AAAA;AAAA;AAAA;AACA;;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;AAEA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAuBA;AACA;AAEA;AACA;AACA;AAHA;AAMA;AACA;AACA;AAHA;AAMA;AACA;AACA;AAHA;AAMA;AACA;AAEA;AAJA;AAOA;AACA;AACA;AAHA;AAvBA;AA8BA;AACA;AAtDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAuDA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AACA;AAJA;AAAA;AAQA;AAAA;AACA;AATA;AAQA;AACA;AACA;AACA;AAEA;AACA;AAFA;AAIA;AAAA;AACA;AAjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAxDA;AAAA;AAAA;AAAA;AACA;AADA;AA2EA;AAEA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAhFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiFA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAKA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAlFA;AAAA;AAAA;AAAA;AACA;AADA;AAiGA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAtGA;AAuGA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAXA;AACA;AAYA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAzHA;AA0HA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AAHA;AAKA;AAAA;AAEA;AAvBA;AACA;AA3HA;AAoJA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAxJA;AAyJA;AAEA;AAAA;AAAA;AACA;AACA;AA7JA;AA8JA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAHA;AAKA;AACA;AAtKA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAFA;AAUA;AACA;;;AACA;AACA;AAAA;AAAA;AACA;AAFA;AACA;AAIA;AACA;AACA;AACA;;;AAqJA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAEA;AACA;AACA;AACA;AACA;AAHA;AAFA;AAQA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAJA;AAUA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AANA;AAQA;AAAA;AAIA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAHA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAJA;AAYA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAAA;AAAA;AAVA;AAaA;AAAA;AAOA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAcA;;;;AAnRA;AACA;AAqRA;;;;;;;;;;;;;;;;;;;;AC9UA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAEA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAJA;AAUA;AA9BA;AAiCA;AACA;AACA;;;;A","sourceRoot":""}